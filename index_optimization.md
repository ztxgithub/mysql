# 索引优化

## 概念

```shell
    1.索引的主要作用是告诉存储引擎 如何快速的找到我们所需要的数据，当表中的数据比较少时，查询的数据频率比较低的情况下，索引的作用不是
      太明显，这时表中的数据都可以缓存到内存中，就算进行全表扫描也不会太慢。随着表中数据越来越多，查询的频率越来越高，内存已经不能
      完全缓存表中的数据，这时索引的作用就很重要。
    2.MySQL的索引是在存储引擎层实现的，不同的存储引擎其索引的实现方式不同。
```

## MySQL支持的索引类型

```shell
    1.B-tree索引
        (1) 特点
                通常我们所说的索引是B-tree索引，它使用的是B+树中存储数据，在B+树中每一个节点都包含指向下一个节点的指针，这样可以方便
                节点之间的遍历
                A. B-tree索引以B+树中存储数据
                B. B-tree索引能够加快数据的查询速度,使用B-tree索引就不需要进行全表扫描来获取需要的数据，是从索引的根节点进行搜索，
                   逐一的向下进行查找，在innodb中叶子节点指向的主键，而在MyISAM中叶子节点指向的是物理地址
                C. B-tree索引更适合进行范围查找。 其是顺序存储
            
        (2) 适合场景
                A.全值匹配的查询 
                B.匹配最左前缀的查询
                    如果定义索引为联合索引(order_id,order_data)2列联合形成索引，需要查询order_id=1&&order_data=2018-1-1其用到
                    了索引，如果只查询order_id =2,则也会用到索引。
                    如果只查询order_data=2018-1-1则不会用到联合索引(order_id,order_data)。这就是最左前缀的查询
                C.匹配列前缀查询
                    可以匹配某一列的前缀部分，order_id like '9856%',查找所有9856开头的订单号
                    
                D.匹配范围值的查询(更适合的操作)
                    例如 order_id > '1000' and order_id < '9000' 
                E.精确匹配左前列并范围匹配另外一列
                    如果定义索引为联合索引(order_id,order_data)2列联合形成索引，则可以精确order_id=‘123’，并且order_data
                    处于某个时间段的范围
                    
        (3) Btree 索引的使用限制
                使用索引所命中数据如果占用表中大部分数据时，MySQL的查询优化器会认为使用全表扫描的方式性能会更好，就不会使用索引的方式
                进行查询。
                
                A.如果不是按照索引最左列开始查找，则无法使用索引
                    这是针对联合索引而言的，例如联合索引(order_id,order_data)，查询的顺序一定是先order_id，例如
                    order_id ='123' and order_data='2018-01-01' 这是有用到索引
                    order_data='2018-01-01' and order_id ='123'   这是没有用到索引
                    
                B.使用索引时不能跳过索引中的列
                    有联合索引 (order_date,order_name,order_phone_number),如果我们在查找中只包括order_date和
                    order_phone_number，那么对于这个查询来说，只能使用order_date这一列进行查询过滤，
                    而无法使用到order_phone_number这一列，因为我们的查询条件中跳过了 order_name 这一列
                    
                C.Not in 和 < > 操作无法使用索引
                
                D.如果查询中有某个列的范围查询，则其右边所有列都无法使用索引
                    这是针对联合索引而言的
                    
    2.Hash索引
    
        (1) 特点
            A. Hash索引是基于Hash表实现的，只有查询条件精确匹配Hash索引中的所有列时，才能够使用到Hash索引。
               Hash索引只能用于等值查询中，如果我们要进行范围查询或则模糊查询就不能使用Hash索引
            B. 对于Hash索引中的所有列，存储引擎都会为每一行计算一个Hash码，Hash索引中存储的就是Hash码
            
        (2) 使用限制
            A.hash索引必须进行二次查找
                使用Hash索引需要2次查找，hash索引中包括只是键值，hash码以及对应的指针，索引中并没有保存字段值，
                所以使用hash索引时必须先通过hash索引找到对应的行，再对行的记录进行读取
                
            B.Hash索引无法用于排序
            C.Hash索引不支持部分索引查找也不支持范围查找
            D.Hash索引中Hash码的计算可能存在Hash冲突
                Hash索引在计算hash码时是有可能冲突的，不同的索引列计算出的hash码是相同的，特别是对应hash的查找效率，
                hash码通常是比较短就算md5的hash值也是有可能存在冲突的，在hash索引中一旦产生大量的hash冲突就会影响hash索引的查找
                和维护的性能，所以说hash索引不适合用在选择性很差（键值列的重复值很多，比如性别）的列上，
                比如身份证列是唯一的，比较合适用于hash索引
                    
```

## 索引的作用

```shell
    1.使用索引可以快速定位到我们需要的数据
    2.索引大大减少了存储引擎需要扫描的数据量
        索引的大小通常远小于表的大小，innodb存储引擎发生一次IO，最小的单位是以页为单位的，所以页内可以存储的信息越多那么他的读取效率
        越快，默认情况下innodb页的大小为16KB。由于索引的大小通常远小于表的大小，所以一页内可以存储更多的索引数据，因此通过索引来进行
        查找所需读取页的数量越少，这样就减少存储引擎进行IO的次数，加快数据查找的速度
    3.索引可以帮助我们进行排序以避免使用临时表
        由于Btree存储是按照键值的顺序来存储，我们可以利用Btree索引排序，这样避免使用临时表进行排序减少IO消耗，
        同时提高了MySQL的处理能力
        
    4.索引可以把随机I/O变为顺序I/O
        由于Btree存储是按照键值的顺序来存储，而数据行物理地址通常随机分布的，使用索引进行查找可以把随机I/O变为顺序I/O，这样
        可以充分发挥磁盘的IO性能
```

